var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){"use strict";var e=function(){function e(t,i){var o=this;_classCallCheck(this,e);this.element=t,this.options=Joomla.extend({formSelector:".js-stools-form",searchFieldSelector:".js-stools-field-search",clearBtnSelector:".js-stools-btn-clear",mainContainerSelector:".js-stools",searchBtnSelector:".js-stools-btn-search",filterBtnSelector:".js-stools-btn-filter",filterContainerSelector:".js-stools-container-filters",filtersHidden:!0,listBtnSelector:".js-stools-btn-list",listContainerSelector:".js-stools-container-list",listHidden:!0,orderColumnSelector:".js-stools-column-order",orderBtnSelector:".js-stools-btn-order",orderFieldSelector:".js-stools-field-order",orderFieldName:"list[fullordering]",limitFieldSelector:".js-stools-field-limit",defaultLimit:20,activeOrder:null,activeDirection:"ASC",clearListOptions:!1},i),this.theForm=document.querySelector(this.options.formSelector),this.filterButton=document.querySelector(this.options.formSelector+" "+this.options.filterBtnSelector),this.filterContainer=document.querySelector(this.options.formSelector+" "+this.options.filterContainerSelector)?document.querySelector(this.options.formSelector+" "+this.options.filterContainerSelector):"",this.filtersHidden=this.options.filtersHidden,this.listButton=document.querySelector(this.options.listBtnSelector),this.listContainer=document.querySelector(this.options.formSelector+" "+this.options.listContainerSelector),this.listHidden=this.options.listHidden,this.mainContainer=document.querySelector(this.options.mainContainerSelector),this.searchButton=document.querySelector(this.options.formSelector+" "+this.options.searchBtnSelector),this.searchField=document.querySelector(this.options.formSelector+" "+this.options.searchFieldSelector),this.searchString=null,this.clearButton=document.querySelector(this.options.clearBtnSelector),this.orderCols=Array.prototype.slice.call(document.querySelectorAll(this.options.formSelector+" "+this.options.orderColumnSelector)),this.orderField=document.querySelector(this.options.formSelector+" "+this.options.orderFieldSelector),this.limitField=document.querySelector(this.options.formSelector+" "+this.options.limitFieldSelector),this.activeColumn=null,this.activeDirection=this.options.activeDirection,this.activeOrder=this.options.activeOrder,this.activeLimit=null,this.clearListOptions=this.options.clearListOptions;var r=this;this.searchString=this.searchField.value,this.filterContainer&&this.filterContainer.classList.contains("js-stools-container-filters-visible")?(this.showFilters(),this.showList()):(this.hideFilters(),this.hideList()),this.filterButton&&this.filterButton.addEventListener("click",function(e){r.toggleFilters(),e.stopPropagation(),e.preventDefault()}),this.listButton&&this.listButton.addEventListener("click",function(e){r.toggleList(),e.stopPropagation(),e.preventDefault()}),this.getFilterFields()&&this.getFilterFields().forEach(function(e){r.checkFilter(e),e.addEventListener("change",function(){r.checkFilter(e)})}),this.clearButton&&this.clearButton.addEventListener("click",r.clear),this.createOrderField(),this.orderCols.forEach(function(e){e.addEventListener("click",function(){var e=r.getAttribute("data-order"),t=r.getAttribute("data-direction"),i=e+" "+t;e.length&&(r.activeColumn=e,i!==r.activeOrder?(r.activeDirection=t,r.activeOrder=i,r.updateFieldValue(r.orderField,i)):r.toggleDirection(),r.theForm.submit())})}),this.checkActiveStatus(this),document.body.addEventListener("click",function(){document.body.classList.contains("filters-shown")&&o.hideFilters()}),this.filterContainer.addEventListener("click",function(e){e.stopPropagation()},!0)}return _createClass(e,[{key:"checkFilter",value:function(e){var t=e.querySelector("option:checked");t&&(""!==t.value?this.activeFilter(e,this):this.deactiveFilter(e,this))}},{key:"clear",value:function(){var e=this;e.searchField&&(e.searchField.value=""),e.getFilterFields()&&e.getFilterFields().forEach(function(t){t.value="",e.checkFilter(t),window.jQuery&&window.jQuery.chosen&&window.jQuery(t).trigger("liszt:updated")}),e.clearListOptions&&(e.getListFields().forEach(function(t){t.value="",e.checkFilter(t),window.jQuery&&window.jQuery.chosen&&window.jQuery(t).trigger("liszt:updated")}),document.querySelector("#list_limit").value=e.options.defaultLimit,window.jQuery&&window.jQuery.chosen&&window.jQuery("#list_limit").trigger("liszt:updated")),e.theForm.submit()}},{key:"checkActiveStatus",value:function(e){var t=e.mainContainer;[].slice.call(t.querySelectorAll(".js-stools-field-filter select")).forEach(function(t){t.classList.contains("active")&&(e.filterButton.classList.remove("btn-secondary"),e.filterButton.classList.add("btn-primary"))})}},{key:"activeFilter",value:function(e){e.classList.add("active");var t="#"+e.getAttribute("id"),i=e.querySelector(t);i&&i.classList.add("active")}},{key:"deactiveFilter",value:function(e){e.classList.remove("active");var t="#"+e.getAttribute("id"),i=e.querySelector(t);i&&i.classList.remove("active")}},{key:"getFilterFields",value:function(){if(this.filterContainer)return Array.prototype.slice.call(this.filterContainer.querySelectorAll("select,input"))}},{key:"getListFields",value:function(){return Array.prototype.slice.call(this.listContainer.querySelectorAll("select"))}},{key:"hideContainer",value:function(e){e&&(e.classList.remove("js-filters-show"),document.body.classList.remove("filters-shown"))}},{key:"showContainer",value:function(e){e.classList.add("js-filters-show"),document.body.classList.add("filters-shown")}},{key:"toggleContainer",value:function(e){e.classList.contains("js-filters-show")?this.hideContainer(e):this.showContainer(e)}},{key:"hideList",value:function(){this.hideContainer(this.filterContainer)}},{key:"showList",value:function(){this.showContainer(this.filterContainer)}},{key:"toggleList",value:function(){this.toggleContainer(this.filterContainer)}},{key:"hideFilters",value:function(){this.hideContainer(this.filterContainer)}},{key:"showFilters",value:function(){this.showContainer(this.filterContainer)}},{key:"toggleFilters",value:function(){this.toggleContainer(this.filterContainer)}},{key:"toggleDirection",value:function(){var e="ASC";"ASC"===this.activeDirection.toUpperCase()&&(e="DESC"),this.activeDirection=e,this.activeOrder=this.activeColumn+" "+e,this.updateFieldValue(this.orderField,this.activeOrder)}},{key:"createOrderField",value:function(){var e=this,t=this;(this.orderField||(this.orderField=document.createElement("input"),this.orderField.setAttribute("type","hidden"),this.orderField.setAttribute("id","js-stools-field-order"),this.orderField.setAttribute("class","js-stools-field-order"),this.orderField.setAttribute("name",t.options.orderFieldName),this.orderField.setAttribute("value",t.activeOrder+" "+this.activeDirection),this.theForm.innerHTML+=this.orderField.outerHTML),"select"===this.orderField.tagName.toLowerCase())&&([].slice.call(this.orderField.options).forEach(function(i){var o=i.getAttribute("data-order"),r=i.getAttribute("data-name"),s=i.getAttribute("data-direction");if(o&&o.length){o=o+" "+s;var n=t.findOption(t.orderField,o);n.length||((n=document.createElement("option")).text=r,n.value=o,i.classList.contains("active")&&n.setAttribute("selected","selected"),e.orderFieldName.innerHTML+=n)}}),window.jQuery&&window.jQuery.chosen&&window.jQuery(this.orderField).trigger("liszt:updated"));this.activeOrder=this.orderField.value}},{key:"updateFieldValue",value:function(e,t){var i=e.getAttribute("type");if("hidden"===i||"text"===i)e.setAttribute("value",t);else if("select"===e.tagName.toLowerCase()){var o=void 0;if([].slice.call(e.options).forEach(function(e){e.value===t&&(o=e)}),o&&o.length)o.setAttribute("selected","selected");else{var r=document.createElement("option");r.text=t,r.value=t,r.setAttribute("selected","selected"),e.appendChild(r)}e.value=t,window.jQuery&&window.jQuery.chosen&&e.trigger("liszt:updated")}}},{key:"findOption",value:function(e,t){for(var i=0,o=e.length;o>i;i++)if(e[i].value===t)return e[i]}}]),e}();document.addEventListener("DOMContentLoaded",function t(){if(Joomla.getOptions("searchtools")){var i=Joomla.getOptions("searchtools"),o=document.querySelector(i.selector);new e(o,i)}document.removeEventListener("DOMContentLoaded",t)})}();
